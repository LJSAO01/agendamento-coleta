<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agendamento de Coleta</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:15px;
}
.container{
  background:#fff;
  max-width:1100px;
  margin:auto;
  padding:20px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
}

h1,h2{text-align:center;margin:5px 0}
h2{color:#666;font-size:18px}

label{
  font-weight:bold;
  margin-bottom:6px;
  display:block;
}

input,select{
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:4px;
  font-size:16px;
}

.row{
  display:flex;
  gap:12px;
  margin-bottom:15px;
  align-items:flex-end;
}

/* inputs crescem */
.field{
  flex:1;
  min-width:0;
}

/* botão NÃO cresce */
.action{
  flex:0 0 180px;
}

button{
  width:100%;
  background:#C62828;
  color:#fff;
  padding:14px;
  border:none;
  border-radius:4px;
  font-size:16px;
  cursor:pointer;
}
button:disabled{background:#999}

.msg{
  display:none;
  padding:12px;
  border-radius:4px;
  margin-bottom:15px;
  font-size:15px;
}
.ok{background:#e6f4ea;color:#1e7e34}
.err{background:#fdecea;color:#a71d2a}
.warn{background:#fff4e5;color:#8a5a00}

/* mobile */
@media(max-width:768px){
  .row{
    flex-direction:column;
    align-items:stretch;
  }
  .action{
    flex:1;
  }
}
</style>
</head>

<body>
<div class="container">

<h1>Agendamento de Coleta</h1>
<h2>JADLOG – LJ SÃO PAULO 01</h2>

<div id="msg" class="msg"></div>

<form id="form">

<!-- REMETENTE -->
<div class="row">
  <div class="field">
    <label>CNPJ / CPF Remetente</label>
    <input id="cnpj" placeholder="00.000.000/0000-00 ou 000.000.000-00" required>
  </div>
  <div class="action">
    <button type="button" onclick="buscarCNPJ()">Buscar Remetente</button>
  </div>
  <div class="field">
    <label>Remetente</label>
    <input id="remetente" required>
  </div>
</div>

<div class="row">
  <div class="field">
    <label>Solicitante</label>
    <input id="solicitante" required>
  </div>
  <div class="field">
    <label>Telefone</label>
    <input id="telefone" placeholder="(11) 00000-0000" required>
  </div>
</div>

<div class="row">
  <div class="field"><label>Endereço</label><input id="endereco" required></div>
  <div class="field"><label>Bairro</label><input id="bairro" required></div>
  <div class="field"><label>CEP</label><input id="cep" required></div>
</div>

<!-- DESTINATÁRIO -->
<div class="row">
  <div class="field">
    <label>CNPJ / CPF Destinatário</label>
    <input id="cnpjDestinatario" placeholder="00.000.000/0000-00 ou 000.000.000-00" required>
  </div>
  <div class="action">
    <button type="button" onclick="buscarDestinatario()">Buscar Destinatário</button>
  </div>
  <div class="field">
    <label>Destinatário</label>
    <input id="destinatario" required>
  </div>
</div>

<div class="row">
  <div class="field"><label>NF</label><input id="nf" required></div>
  <div class="field"><label>Material</label><input id="material" required></div>
  <div class="field"><label>Medidas</label><input id="medidas" placeholder="AxLxC" required></div>
  <div class="field"><label>Peso</label><input id="peso" required></div>
</div>

<div class="row">
  <div class="field"><label>Expediente</label><input id="funcionamento" required></div>
  <div class="field">
    <label>Pagamento</label>
    <select id="pagamento">
      <option value="FOB">FOB</option>
      <option value="PIX">PIX</option>
    </select>
  </div>
  <div class="field">
    <label>Cotação</label>
    <select id="cotacao">
      <option value="NÃO">NÃO</option>
      <option value="SIM">SIM</option>
    </select>
  </div>
  <div class="field"><label>Nº Cotação</label><input id="numero"></div>
</div>

<button id="btnSubmit" type="submit">Agendar Coleta</button>

</form>
</div>

<script>
const API='https://script.google.com/macros/s/AKfycbwgPaeST_XV538TF0PzJrrckS9N8Ktf03nZoHJzUMT6B3a553LbznrEM7MSE3oEt3K3/exec';
const msg=document.getElementById('msg');
const btn=document.getElementById('btnSubmit');

function show(t,c){
  msg.className='msg '+c;
  msg.innerText=t;
  msg.style.display='block';
}

/* MÁSCARAS */
function maskDoc(el){
  let v=el.value.replace(/\D/g,'');
  el.value=v.length<=11
    ?v.replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2')
    :v.replace(/^(\d{2})(\d)/,'$1.$2').replace(/^(\d{2})\.(\d{3})(\d)/,'$1.$2.$3')
      .replace(/\.(\d{3})(\d)/,'.$1/$2').replace(/(\d{4})(\d)/,'$1-$2');
}
function maskTel(el){
  let v=el.value.replace(/\D/g,'');
  el.value=v.length<=10
    ?v.replace(/^(\d{2})(\d)/,'($1) $2').replace(/(\d{4})(\d)/,'$1-$2')
    :v.replace(/^(\d{2})(\d)/,'($1) $2').replace(/(\d{5})(\d)/,'$1-$2');
}

cnpj.oninput=()=>maskDoc(cnpj);
cnpjDestinatario.oninput=()=>maskDoc(cnpjDestinatario);
telefone.oninput=()=>maskTel(telefone);

/* BUSCAS */
function buscarCNPJ(){
  const d=cnpj.value.replace(/\D/g,'');
  if(d.length!==14){show('Consulta disponível apenas para CNPJ.','warn');return;}
  show('Buscando dados do CNPJ...','warn');
  fetch(API,{method:'POST',body:JSON.stringify({action:'buscarCNPJ',cnpj:d})})
  .then(r=>r.json())
  .then(res=>{
    if(!res){show('CNPJ não encontrado','err');return;}
    remetente.value=res.nome;
    endereco.value=res.endereco;
    bairro.value=res.bairro;
    cep.value=res.cep;
    show('CNPJ localizado com sucesso','ok');
  });
}
function buscarDestinatario(){
  const d=cnpjDestinatario.value.replace(/\D/g,'');
  fetch(API,{method:'POST',body:JSON.stringify({action:'buscarCNPJ',cnpj:d})})
  .then(r=>r.json())
  .then(res=>{
    if(!res){show('Documento não encontrado','err');return;}
    destinatario.value=res.nome;
    show('Destinatário localizado','ok');
  });
}

/* SUBMIT */
form.onsubmit=e=>{
  e.preventDefault();
  btn.disabled=true;
  btn.innerText='AGENDANDO... AGUARDAR!!!';
  const v=id=>document.getElementById(id).value;

  fetch(API,{
    method:'POST',
    body:JSON.stringify({
      action:'agendar',
      payload:{
        cnpj:v('cnpj'),
        remetente:v('remetente'),
        solicitante:v('solicitante'),
        telefone:v('telefone'),
        endereco:v('endereco'),
        bairro:v('bairro'),
        cep:v('cep'),
        cnpjDestinatario:v('cnpjDestinatario'),
        destinatario:v('destinatario'),
        nf:v('nf'),
        material:v('material'),
        medidas:v('medidas'),
        peso:v('peso'),
        funcionamento:v('funcionamento'),
        pagamento:v('pagamento'),
        cotacao:v('cotacao'),
        numero:v('numero')
      }
    })
  })
  .then(r=>r.text())
  .then(t=>{
    show(t,'ok');
    btn.disabled=false;
    btn.innerText='Agendar Coleta';
    form.reset();
  });
};
</script>
</body>
</html>
