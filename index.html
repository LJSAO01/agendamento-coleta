<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Agendamento de Coleta</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  padding:20px;
  font-family:Arial,Helvetica,sans-serif;
  background:#f3f3f3;
}
.container{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
  box-shadow:0 4px 15px rgba(0,0,0,.08);
}
h1{text-align:center;margin-bottom:5px}
h2{text-align:center;color:#666;margin-bottom:25px;font-size:16px}

label{font-weight:bold;margin-bottom:6px;display:block}
input,select{
  width:100%;
  padding:10px;
  border:1px solid #ccc;
  border-radius:5px;
  font-size:14px;
}

.row{
  display:flex;
  gap:15px;
  margin-bottom:18px;
}
.col{flex:1}

.doc-row{
  display:flex;
  gap:15px;
  align-items:flex-end;
  margin-bottom:18px;
}
.doc-input{flex:3}
.doc-btn{flex:1.5}
.doc-name{flex:3}

button{
  background:#c0392b;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:12px;
  font-size:15px;
  cursor:pointer;
}
button:disabled{opacity:.6}

.msg{
  display:none;
  padding:12px;
  border-radius:6px;
  margin-bottom:20px;
  font-weight:bold;
}
.msg.ok{background:#e8f6ec;color:#1e7e34}
.msg.err{background:#fdecea;color:#a71d2a}

@media(max-width:768px){
  .row,.doc-row{flex-direction:column}
}
</style>
</head>

<body>

<div class="container">
<h1>Agendamento de Coleta</h1>
<h2>JADLOG – LJ SÃO PAULO 01</h2>

<div id="msg" class="msg"></div>

<form id="form">

<!-- REMETENTE -->
<div class="doc-row">
  <div class="doc-input">
    <label>CNPJ / CPF Remetente</label>
    <input id="cnpj" placeholder="00.000.000/0000-00 ou 000.000.000-00" required>
  </div>
  <div class="doc-btn">
    <button type="button" onclick="buscarRemetente()">Buscar Remetente</button>
  </div>
  <div class="doc-name">
    <label>Remetente</label>
    <input id="remetente" required>
  </div>
</div>

<div class="row">
  <div class="col">
    <label>Solicitante</label>
    <input id="solicitante" required>
  </div>
  <div class="col">
    <label>Telefone</label>
    <input id="telefone" placeholder="(11) 00000-0000" required>
  </div>
</div>

<div class="row">
  <div class="col">
    <label>Endereço</label>
    <input id="endereco" required>
  </div>
  <div class="col">
    <label>Bairro</label>
    <input id="bairro" required>
  </div>
  <div class="col">
    <label>CEP</label>
    <input id="cep" required>
  </div>
</div>

<!-- DESTINATÁRIO -->
<div class="doc-row">
  <div class="doc-input">
    <label>CNPJ / CPF Destinatário</label>
    <input id="cnpjDestinatario" placeholder="00.000.000/0000-00 ou 000.000.000-00" required>
  </div>
  <div class="doc-btn">
    <button type="button" onclick="buscarDestinatario()">Buscar Destinatário</button>
  </div>
  <div class="doc-name">
    <label>Destinatário</label>
    <input id="destinatario" required>
  </div>
</div>

<div class="row">
  <div class="col">
    <label>NF</label>
    <input id="nf" required>
  </div>
  <div class="col">
    <label>Material</label>
    <input id="material" required>
  </div>
  <div class="col">
    <label>Medidas</label>
    <input id="medidas" placeholder="AxLxC" required>
  </div>
  <div class="col">
    <label>Peso</label>
    <input id="peso" required>
  </div>
</div>

<div class="row">
  <div class="col">
    <label>Expediente</label>
    <input id="funcionamento" required>
  </div>
  <div class="col">
    <label>Pagamento</label>
    <select id="pagamento">
      <option>FOB</option>
      <option>PIX</option>
    </select>
  </div>
  <div class="col">
    <label>Cotação</label>
    <select id="cotacao">
      <option>NÃO</option>
      <option>SIM</option>
    </select>
  </div>
  <div class="col">
    <label>Nº Cotação</label>
    <input id="numero">
  </div>
</div>

<button id="btnSubmit" style="width:100%">Agendar Coleta</button>
</form>
</div>

<script>
const API='https://script.google.com/macros/s/AKfycbwgPaeST_XV538TF0PzJrrckS9N8Ktf03nZoHJzUMT6B3a553LbznrEM7MSE3oEt3K3/exec';
const msg=document.getElementById('msg');
const btn=document.getElementById('btnSubmit');

function show(t,c){
  msg.className='msg '+c;
  msg.innerText=t;
  msg.style.display='block';
}

function maskDoc(el){
  let v=el.value.replace(/\D/g,'');
  el.value=v.length<=11
    ?v.replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2')
    :v.replace(/^(\d{2})(\d)/,'$1.$2').replace(/^(\d{2})\.(\d{3})(\d)/,'$1.$2.$3')
      .replace(/\.(\d{3})(\d)/,'.$1/$2').replace(/(\d{4})(\d)/,'$1-$2');
}
function maskTel(el){
  let v=el.value.replace(/\D/g,'');
  el.value=v.length<=10
    ?v.replace(/^(\d{2})(\d)/,'($1) $2').replace(/(\d{4})(\d)/,'$1-$2')
    :v.replace(/^(\d{2})(\d)/,'($1) $2').replace(/(\d{5})(\d)/,'$1-$2');
}

cnpj.oninput=()=>maskDoc(cnpj);
cnpjDestinatario.oninput=()=>maskDoc(cnpjDestinatario);
telefone.oninput=()=>maskTel(telefone);

function cepSP(cep){
  const n=cep.replace(/\D/g,'').substring(0,5);
  return (n>=1000&&n<=5999)||(n>=8000&&n<=8499);
}

form.onsubmit=e=>{
  e.preventDefault();

  if(!cepSP(cep.value)){
    show('Agendamento permitido apenas para São Paulo – Capital.','err');
    window.scrollTo({top:0,behavior:'smooth'});
    return;
  }

  btn.disabled=true;
  btn.innerText='AGENDANDO... AGUARDAR!!!';

  const v=id=>document.getElementById(id).value;

  fetch(API,{
    method:'POST',
    body:JSON.stringify({
      action:'agendar',
      payload:{
        cnpj:v('cnpj'),
        remetente:v('remetente'),
        solicitante:v('solicitante'),
        telefone:v('telefone'),
        endereco:v('endereco'),
        bairro:v('bairro'),
        cep:v('cep'),
        cnpjDestinatario:v('cnpjDestinatario'),
        destinatario:v('destinatario'),
        nf:v('nf'),
        material:v('material'),
        medidas:v('medidas'),
        peso:v('peso'),
        funcionamento:v('funcionamento'),
        pagamento:v('pagamento'),
        cotacao:v('cotacao'),
        numero:v('numero')
      }
    })
  })
  .then(r=>r.text())
  .then(t=>{
    show(t,'ok');
    window.scrollTo({top:0,behavior:'smooth'});
    btn.disabled=false;
    btn.innerText='Agendar Coleta';
    form.reset();
  });
};
</script>

</body>
</html>
