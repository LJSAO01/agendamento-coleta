<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agendamento de Coleta</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}
.container{
  background:#fff;
  max-width:1100px;
  margin:auto;
  padding:22px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
}
h1{text-align:center;margin:5px 0;font-size:28px}
h2{text-align:center;margin:0 0 20px;font-size:16px;color:#666}

label{font-weight:600;margin-bottom:4px;display:block;font-size:14px}
input,select{
  width:100%;padding:8px 10px;border:1px solid #ccc;
  border-radius:4px;font-size:14px;height:38px;box-sizing:border-box;
}
.row{display:flex;gap:14px;margin-bottom:14px;align-items:flex-end}
.field{flex:1;min-width:0}
.action{flex:0 0 170px}

button{
  width:100%;background:#C62828;color:#fff;padding:9px;
  border:none;border-radius:4px;font-size:14px;cursor:pointer;height:38px;
}
button:disabled{background:#999}
#btnSubmit{margin-top:10px;height:42px;font-size:15px}

.msg{display:none;padding:10px;border-radius:4px;margin-bottom:15px;font-size:14px}
.ok{background:#e6f4ea;color:#1e7e34}
.err{background:#fdecea;color:#a71d2a}
.warn{background:#fff4e5;color:#8a5a00}

@media(max-width:768px){
  .row{flex-direction:column;align-items:stretch}
  .action{flex:1}
}
</style>
</head>

<body>
<div class="container">

<h1>Agendamento de Coleta</h1>
<h2>JADLOG – LJ SÃO PAULO 01</h2>

<div id="msg" class="msg"></div>

<form id="form">

<div class="row">
  <div class="field">
    <label>CNPJ / CPF Remetente</label>
    <input id="cnpj" required>
  </div>
  <div class="action">
    <button type="button" onclick="buscarCNPJ()">Buscar Remetente</button>
  </div>
  <div class="field">
    <label>Remetente</label>
    <input id="remetente" required>
  </div>
</div>

<div class="row">
  <div class="field"><label>Solicitante</label><input id="solicitante" required></div>
  <div class="field"><label>Telefone</label><input id="telefone" required></div>
</div>

<div class="row">
  <div class="field"><label>Endereço</label><input id="endereco" required></div>
  <div class="field"><label>Bairro</label><input id="bairro" required></div>
  <div class="field"><label>CEP</label><input id="cep" required></div>
</div>

<div class="row">
  <div class="field">
    <label>CNPJ / CPF Destinatário</label>
    <input id="cnpjDestinatario" required>
  </div>
  <div class="action">
    <button type="button" onclick="buscarDestinatario()">Buscar Destinatário</button>
  </div>
  <div class="field">
    <label>Destinatário</label>
    <input id="destinatario" required>
  </div>
</div>

<div class="row">
  <div class="field"><label>NF</label><input id="nf" required></div>
  <div class="field"><label>Material</label><input id="material" required></div>
  <div class="field"><label>Qtd.</label><input id="qtd" required></div>
  <div class="field"><label>Medidas</label><input id="medidas" required></div>
  <div class="field"><label>Peso</label><input id="peso" required></div>
</div>

<div class="row">
  <div class="field"><label>Expediente</label><input id="funcionamento" required></div>
  <div class="field">
    <label>Pagamento</label>
    <select id="pagamento"><option>FOB</option><option>PIX</option></select>
  </div>
  <div class="field">
    <label>Cotação</label>
    <select id="cotacao"><option>NÃO</option><option>SIM</option></select>
  </div>
  <div class="field"><label>Nº Cotação</label><input id="numero"></div>
</div>

<button id="btnSubmit" type="submit">Agendar Coleta</button>

</form>
</div>

<script>
const API='SUA_URL_DO_WEBAPP';
const msg=document.getElementById('msg');
const btn=document.getElementById('btnSubmit');

function show(t,c){
  msg.className='msg '+c;
  msg.innerText=t;
  msg.style.display='block';
}

function buscarCNPJ(){
  const d=cnpj.value.replace(/\D/g,'');
  if(d.length!==14){show('Consulta apenas para CNPJ','warn');return;}
  fetch(API,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({action:'buscarCNPJ',cnpj:d})
  })
  .then(r=>r.json())
  .then(res=>{
    if(!res){show('CNPJ não encontrado','err');return;}
    remetente.value=res.nome;
    endereco.value=res.endereco;
    bairro.value=res.bairro;
    cep.value=res.cep;
    show('CNPJ localizado','ok');
  });
}

function buscarDestinatario(){
  const d=cnpjDestinatario.value.replace(/\D/g,'');
  if(d.length!==14){show('Consulta apenas para CNPJ','warn');return;}
  fetch(API,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({action:'buscarCNPJ',cnpj:d})
  })
  .then(r=>r.json())
  .then(res=>{
    if(!res){show('Documento não encontrado','err');return;}
    destinatario.value=res.nome;
    show('Destinatário localizado','ok');
  });
}

form.onsubmit=e=>{
  e.preventDefault();
  btn.disabled=true;
  btn.innerText='AGENDANDO...';

  const v=id=>document.getElementById(id).value;

  fetch(API,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      action:'agendar',
      payload:{
        cnpj:v('cnpj'),
        remetente:v('remetente'),
        solicitante:v('solicitante'),
        telefone:v('telefone'),
        endereco:v('endereco'),
        bairro:v('bairro'),
        cep:v('cep'),
        cnpjDestinatario:v('cnpjDestinatario'),
        destinatario:v('destinatario'),
        nf:v('nf'),
        material:v('material'),
        medidas:v('medidas'),
        peso:v('peso'),
        funcionamento:v('funcionamento'),
        pagamento:v('pagamento'),
        cotacao:v('cotacao'),
        numero:v('numero'),
        qtd:v('qtd')
      }
    })
  })
  .then(r=>r.text())
  .then(t=>{
    show(t,'ok');
    btn.disabled=false;
    btn.innerText='Agendar Coleta';
    form.reset();
  });
};
</script>

</body>
</html>
